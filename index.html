<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>法律 条文ビューア</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: #f3f4f6;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      background: white;
      padding: 10px;
      border-bottom: 1px solid #ddd;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .progress {
      background: #fff7cc;
      border-bottom: 1px solid #eee;
      padding: 6px 12px;
      font-size: 14px;
    }

    .main {
      flex: 1;
      display: flex;
      overflow: hidden;
    }

    .pane {
      width: 50%;
      height: 100%;
      border-right: 1px solid #ddd;
      background: #ddd;
    }

    .pane:last-child {
      border-right: none;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: white;
    }

    button {
      padding: 6px 12px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    input[type="number"], input[type="text"] {
      padding: 4px;
      width: 120px;
    }
  </style>
</head>

<body>

<div class="topbar">
  <input type="file" id="fileInput" accept="application/pdf" />

  <span id="fileName" style="font-size:14px;color:#555"></span>

  <span>条番号ジャンプ:</span>
  <input type="text" id="articleInput" placeholder="例: 11" />
  <button onclick="jumpArticle()">条文ジャンプ</button>

  <span id="error" style="color:red;font-size:14px"></span>
</div>

<div id="progress" class="progress" style="display:none">
  条番号対応表 生成中… <span id="progressNum">0</span>%
</div>

<div class="main">
  <div class="pane">
    <iframe id="leftPdf"></iframe>
  </div>
  <div class="pane">
    <iframe id="rightPdf"></iframe>
  </div>
</div>

<script>
let pdfUrl = null;

// ===== 仮：条番号 → ページ対応表 =====
// ※ ここを将来自動生成 or JSON化可能
const articlePageMap = {
  "1": 1,
  "2": 2,
  "3": 3,
  "4": 5,
  "5": 7,
  "10": 20,
  "11": 41
};

const fileInput = document.getElementById("fileInput");
const fileNameLabel = document.getElementById("fileName");
const errorLabel = document.getElementById("error");
const leftPdf = document.getElementById("leftPdf");
const rightPdf = document.getElementById("rightPdf");
const progressBox = document.getElementById("progress");
const progressNum = document.getElementById("progressNum");

fileInput.addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;

  try {
    errorLabel.textContent = "";

    if (file.type !== "application/pdf") {
      throw new Error("PDFファイルを選択してください");
    }

    pdfUrl = URL.createObjectURL(file);

    leftPdf.src = pdfUrl;
    rightPdf.src = pdfUrl;

    fileNameLabel.textContent = "読込中: " + file.name;

    startFakeProgress();

  } catch (err) {
    errorLabel.textContent = err.message;
  }
});

function jumpArticle() {
  if (!pdfUrl) return;

  const article = document.getElementById("articleInput").value.trim();

  const targetPage = articlePageMap[article];

  if (!targetPage) {
    errorLabel.textContent = "対応ページ未登録の条番号です";
    return;
  }

  errorLabel.textContent = "";

  rightPdf.src = "";
  setTimeout(() => {
    rightPdf.src = pdfUrl + "#page=" + targetPage;
  }, 50);
}

function startFakeProgress() {
  progressBox.style.display = "block";
  let p = 0;

  const timer = setInterval(() => {
    p += 10;
    progressNum.textContent = p;

    if (p >= 100) {
      clearInterval(timer);
      setTimeout(() => {
        progressBox.style.display = "none";
      }, 500);
    }
  }, 200);
}
</script>

</body>
</html>

// ===== テストケース =====
// 1. PDF読込 → 左右にPDF表示
// 2. 条番号入力 → 右のみジャンプ
// 3. 未登録条番号 → エラー表示
// 4. PDF未読込 → 何も起きない
// 5. 連続読込 → 正常切替
