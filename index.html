<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>条文自動抽出ビュー</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<style>
body{margin:0;font-family:sans-serif;}
.container{display:flex;height:100vh;}
.left{width:50%;border-right:1px solid #ccc;}
.right{width:50%;display:flex;flex-direction:column;}
.topbar{padding:10px;border-bottom:1px solid #ccc;}
.viewer{flex:1;}
iframe{width:100%;height:100%;border:none;}
textarea{width:100%;height:100%;border:none;padding:10px;}
</style>

</head>

<body>

<div class="container">

<div class="left">
<iframe id="pdfFrame"></iframe>
</div>

<div class="right">

<div class="topbar">
<input type="file" accept="application/pdf" onchange="loadPDF(event)">
<input placeholder="例：第75条の7" id="searchBox">
<button onclick="searchArticle()">抽出</button>
</div>

<div class="viewer">
<textarea id="result"></textarea>
</div>

</div>

</div>

<script>

let fullText = "";

async function loadPDF(e){

const file = e.target.files[0];
if(!file) return;

const url = URL.createObjectURL(file);
document.getElementById("pdfFrame").src = url;

const arrayBuffer = await file.arrayBuffer();
const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;

let text = "";

for(let i=1;i<=pdf.numPages;i++){
const page = await pdf.getPage(i);
const content = await page.getTextContent();
text += content.items.map(s=>s.str).join(" ") + "\n";
}

fullText = text;
alert("PDF解析完了");

}

function searchArticle(){

const key = document.getElementById("searchBox").value.trim();
if(!key) return;

const regex = new RegExp(key + "[\\s\\S]*?(第[一二三四五六七八九十百]+条|$)");
const match = fullText.match(regex);

document.getElementById("result").value =
match ? match[0] : "見つかりません";

}

</script>

</body>
</html>
