<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>法律 条番号 → ページ JSON編集ツール</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: #f3f4f6;
      padding: 20px;
    }

    h1 {
      margin-top: 0;
    }

    .card {
      background: white;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      border-bottom: 1px solid #eee;
      padding: 8px;
      text-align: left;
    }

    input {
      padding: 6px;
      width: 120px;
    }

    button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      background: #2563eb;
      color: white;
      cursor: pointer;
      margin-right: 6px;
    }

    .danger {
      background: #dc2626;
    }

  </style>
</head>

<body>

<h1>条番号 → ページ 対応表 JSON 編集ツール</h1>

<div class="card">
  <h3>JSON読み込み</h3>
  <input type="file" id="jsonFile" accept="application/json" />
</div>

<div class="card">
  <h3>条文追加</h3>
  条番号 <input id="articleInput" placeholder="例：11" />
  ページ <input id="pageInput" type="number" placeholder="例：41" />
  <button onclick="addRow()">追加</button>
</div>

<div class="card">
  <h3>対応表</h3>
  <table>
    <thead>
      <tr>
        <th>条番号</th>
        <th>ページ</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<div class="card">
  <button onclick="downloadJson()">JSON保存</button>
</div>

<script>
let articleMap = {};

const tbody = document.getElementById("tableBody");

// ===== JSON読み込み =====
document.getElementById("jsonFile").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    try {
      articleMap = JSON.parse(reader.result);
      renderTable();
    } catch {
      alert("JSON読み込み失敗");
    }
  };
  reader.readAsText(file);
});

// ===== 行追加 =====
function addRow() {
  const art = document.getElementById("articleInput").value.trim();
  const page = Number(document.getElementById("pageInput").value);

  if (!art || !page) return alert("入力してください");

  articleMap[art] = page;
  renderTable();
}

// ===== 削除 =====
function deleteRow(key) {
  delete articleMap[key];
  renderTable();
}

// ===== 表描画 =====
function renderTable() {
  tbody.innerHTML = "";

  Object.keys(articleMap)
    .sort((a,b)=>Number(a)-Number(b))
    .forEach(key => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${key}</td>
        <td>${articleMap[key]}</td>
        <td><button class="danger" onclick="deleteRow('${key}')">削除</button></td>
      `;

      tbody.appendChild(tr);
    });
}

// ===== JSON保存 =====
function downloadJson() {
  const blob = new Blob([JSON.stringify(articleMap, null, 2)], { type:"application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "law_article_map.json";
  a.click();
}
</script>

</body>
</html>
